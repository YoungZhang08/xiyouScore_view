!function(){var e={init:function(){e.userPortrait(),e.infoDetail(),e.exitLogin()},userPortrait:function(){var e="http://scoreapi.xiyoumobile.com/users/img?username="+window.localStorage.username+"&session="+window.localStorage.session+"&name="+window.localStorage.name;document.querySelector(".img_header").querySelector("img").src=e,document.querySelector(".portrait").querySelector("img").src=e},infoDetail:function(){document.querySelector(".per_name").querySelector("span");Ajax({url:"http://localhost:8000/users/info",method:"GET",dataType:"jsonp",data:{username:window.localStorage.username,session:window.localStorage.session,name:window.localStorage.name},success:function(e){var t=document.createDocumentFragment(),n=document.createElement("div");n.className="info_det",n.innerHTML='<div class="user_id">'+e.result.username+'</div><div class="user_birth">'+e.result.birthday.substr(0,4)+"年"+e.result.birthday.substr(4,2)+"月"+e.result.birthday.substr(6,2)+'日</div><div class="user_academy">'+e.result.academy+'</div><div class="user_class">'+e.result.class+'</div><div class="user_level">'+e.result.level+'级</div><div class="user_sex">'+e.result.sex,window.localStorage.level=e.result.level,t.appendChild(n),document.querySelector(".info_main").appendChild(t)}})},exitLogin:function(){document.querySelector(".login_out").addEventListener("click",function(){window.localStorage.name="",window.localStorage.username="",window.localStorage.password="",window.localStorage.session="",window.location.href="../index.html"},!1)}};e.init()}(),function(){var e={init:function(){e.verCode(),e.verHandle(),e.subHandle()},verCode:function(){Ajax({url:"http://localhost:8000/users/verCode",method:"GET",dataType:"jsonp",success:function(e){document.querySelector(".verBtn").querySelector("img").setAttribute("src",e.result.verCode),window.localStorage.session=e.result.session}})},verHandle:function(){document.querySelector(".verBtn").addEventListener("click",function(){e.verCode()},!1)},submit:function(){var e={username:document.querySelector(".username").value,password:document.querySelector(".password").value,verCode:document.querySelector(".verCode").value};""==e.username||""==e.password?alert("用户信息不能为空!"):""==e.verCode&&alert("请填写验证码!"),Ajax({url:"http://localhost:8000/users/login",method:"POST",dataType:"jsonp",data:{username:e.username,password:e.password,verCode:e.verCode,session:window.localStorage.session},success:function(t){0==t.error?(alert("登录成功!"),window.localStorage.name=t.result,window.localStorage.username=e.username,window.localStorage.password=e.password,window.location.href="../html/main.html",e.verCode=""):alert("登录失败!")}})},subHandle:function(){document.querySelector(".login_btn").addEventListener("click",function(){e.submit()})}};e.init()}(),function(){var e={init:function(){e.notThrough(),e.makeup()},setSemster:function(){for(var e=document.querySelector(".content_sel"),t=window.localStorage.level,n=2*((new Date).getFullYear()-t),s=1;s<=n;s++){var o=document.createElement("option");e.appendChild(o),s%2==1?o.innerHTML=t+"-"+(Number(t)+Number(1))+"学年第1学期":s%2==0&&(o.innerHTML=t+"-"+(Number(t)+Number(1))+"学年第2学期",t++)}var r=e.getElementsByTagName("option");e.addEventListener("change",function(){return[r[e.selectedIndex].innerHTML.substr(0,9),r[e.selectedIndex].innerHTML.substr(12,1)]},!1)},notThrough:function(){Ajax({url:"http://localhost:8000/score/notThrough",method:"GET",dataType:"jsonp",data:{username:window.localStorage.username,session:window.localStorage.session,name:window.localStorage.name},success:function(t){e.fixNotThrough(t.result.length,t.result)}})},makeup:function(){Ajax({url:"http://localhost:8000/makeUp/makeUp",method:"GET",dataType:"jsonp",data:{username:window.localStorage.username,session:window.localStorage.session,name:window.localStorage.name},success:function(t){e.fixMakeup(t.result.length,t.result)}})},passed:function(){e.setSemster(),Ajax({url:"http://localhost:8000/score/semester",method:"GET",dataType:"jsonp",data:{username:window.localStorage.username,session:window.localStorage.session,name:window.localStorage.name},success:function(t){e.setSemster()}})},fixSemester:function(e,t){},fixNotThrough:function(e,t){for(var n=document.createDocumentFragment(),s=0;s<e;s++){var o=document.createElement("div");o.className="score_item",o.innerHTML='<div class="item_1"><div class="class_name">'+t[s].className+'</div><div class="class_nature"><img src=""></div></div><div class="item_2"><div class="credit">学分</div><div class="cre">'+t[s].credit+'</div><div class="heighest">最高成绩</div><div class="cre">'+t[s].highest+"</div></div></div>";var r=o.querySelector(".class_nature").querySelector("img");"必修课"==t[s].nature?r.setAttribute("src","../image/icon/scr_icon_must.png"):"选修课"==t[s].nature&&r.setAttribute("src","../image/icon/src_icon_slt.png"),n.appendChild(o)}document.querySelector(".notThr_show").appendChild(n)},fixMakeup:function(e,t){for(var n=document.createDocumentFragment(),s=0;s<e;s++){var o=document.createElement("div");o.className="score_item",o.innerHTML='<div class="item_1"><div class="class_name">'+t[s].className+'</div><div class="class_room">考场&nbsp;&nbsp;<span color="black">'+t[s].seat+'</span></div></div><div class="item_2"><div class="class_time">时间&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span color="black">'+t[s].room+"</span></div></div>",n.appendChild(o)}document.querySelector(".makeup_show").appendChild(n)}};e.init()}();var shadowLayout=function(e){e.style.position="absolute",e.style.width="32%",e.style.height="100%",e.style.top="0",e.style.right="-32%",e.style.zIndex="-999"},ltor_click=function(e){e.protrait.addEventListener("click",function(){e.main_content.style.webkitTransform="translate3d(40%,0px,0px)",e.main_content.style.webkitTransition=".8s",e.shadow.style.zIndex="999",e.shadow.style.webkitTransform="translate3d(-100%,0px,0px)",e.shadow.style.webkitTransition=".8s",e.shadow.style.backgroundColor="rgba(0,0,0,.3)"},!1)},rtol_click=function(e){e.back.addEventListener("click",function(){e.main_content.style.webkitTransform="translate3d(0px,0px,0px)",e.main_content.style.webkitTransition=".8s",e.shadow.style.webkitTransform="translate3d(0px,0px,0px)",e.shadow.style.webkitTransition=".8s"},!1)};!function(){var e={main_content:document.querySelector(".main_content"),back:document.querySelector(".back"),container:document.querySelector(".container"),protrait:document.querySelector(".portrait"),shadow:document.createElement("div"),body:document.querySelector("body")};shadowLayout(e.shadow),e.body.appendChild(e.shadow),ltor_click(e),rtol_click(e)}(),function(){var e=document.getElementsByClassName("sel_opt"),t=[document.querySelector(".passed_show"),document.querySelector(".notThr_show"),document.querySelector(".makeup_show")];t[0].style.display="block",t[1].style.display="none",t[2].style.display="none",e[0].querySelector("img").setAttribute("src","../image/icon/scr_btn_pass_pre.png"),e[1].querySelector("img").setAttribute("src","../image/icon/scr_btn_upass_upre.png"),e[2].querySelector("img").setAttribute("src","../image/icon/scr_btn_inqu_upre.png"),e[0].addEventListener("click",function(){t[0].style.display="block",t[1].style.display="none",t[2].style.display="none",e[0].querySelector("img").setAttribute("src","../image/icon/scr_btn_pass_pre.png"),e[1].querySelector("img").setAttribute("src","../image/icon/scr_btn_upass_upre.png"),e[2].querySelector("img").setAttribute("src","../image/icon/scr_btn_inqu_upre.png")},!1),e[1].addEventListener("click",function(){t[0].style.display="none",t[1].style.display="block",t[2].style.display="none",e[0].querySelector("img").setAttribute("src","../image/icon/scr_btn_pass_upre.png"),e[1].querySelector("img").setAttribute("src","../image/icon/scr_btn_upass_pre.png"),e[2].querySelector("img").setAttribute("src","../image/icon/scr_btn_inqu_upre.png")},!1),e[2].addEventListener("click",function(){t[0].style.display="none",t[1].style.display="none",t[2].style.display="block",e[0].querySelector("img").setAttribute("src","../image/icon/scr_btn_pass_upre.png"),e[1].querySelector("img").setAttribute("src","../image/icon/scr_btn_upass_upre.png"),e[2].querySelector("img").setAttribute("src","../image/icon/scr_btn_inqu_pre.png")},!1)}();